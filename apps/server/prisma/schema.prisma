// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

generator nestgraphql {
  provider = "prisma-nestjs-graphql"
  output   = "../src/@generated"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id                    String       @id
  profile               Profile?
  createdAt             DateTime     @default(now()) @map("created_at")
  updatedAt             DateTime     @updatedAt @map("updated_at")
  playlist              Playlist[]
  accessToken           AccessToken?
  todoListsOwned        TodoList[]   @relation(name: "owner")
  todoListsCollaborated TodoList[]   @relation(name: "collaborators")

  @@map("user")
}

// For DB Inspect
model Profile {
  user                  User   @relation(fields: [userId], references: [id])
  userId                String @unique @map("user_id")
  username              String
  lastInteractGuildName String @map("last_interact_guild_name")
  avatarUrl             String @map("avatar_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("profile")
}

model AccessToken {
  token  String   @unique
  issued DateTime @default(now())
  expire DateTime
  user   User     @relation(fields: [userId], references: [id])
  userId String   @unique @map("user_id")

  @@map("access_token")
}

model Playlist {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  owner       User    @relation(fields: [ownerId], references: [id])
  ownerId     String  @map("owner_id")
  music       Music[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("playlist")
}

model Music {
  videoId          String     @id @map("video_id")
  title            String
  shortDescription String     @map("short_description")
  lengthSeconds    Int        @map("length_seconds")
  viewCount        Int        @map("view_count")
  authorName       String     @map("author_name")
  authorChannelUrl String     @map("author_channel_url")
  thumbnailUrl     String     @map("thumbnail_url")
  likes            Int
  playlist         Playlist[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("music")
}

enum TodoStatus {
  Todo
  InProgress
  Review
  Done
}

model TodoItem {
  id          Int       @id @default(autoincrement())
  title       String
  description String
  color       String
  todoList    TodoList? @relation(fields: [todoListId], references: [id])
  todoListId  Int?      @map("todo_list_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("todo_item")
}

model TodoList {
  id            Int        @id @default(autoincrement())
  name          String
  description   String
  todoItems     TodoItem[]
  owner         User       @relation(name: "owner", fields: [ownerId], references: [id])
  ownerId       String     @map("owner_id")
  collaborators User[]     @relation(name: "collaborators")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("todo_list")
}
